# BuildOS — i18n и мультивалюта (v0)

## 1) Цель
Сделать BuildOS готовым к масштабированию:
- многоязычный интерфейс (RU/PL → EU → US)
- мультивалюта без привязки языка к валюте
- корректные форматы дат, чисел, единиц измерения

Важно: **язык ≠ страна ≠ валюта**.

---

## 2) Уровни локализации

### 2.1 Язык интерфейса (User-level)
- Пользователь выбирает язык в профиле
- Язык хранится как `user.locale`
- По умолчанию берётся из `tenant.default_locale`

Поддержка:
- RU, PL (старт)
- EN (обязательно для EU/US)
- далее: DE, FR, IT, ES

---

### 2.2 Язык контента (Data-level)
Переводимые сущности:
- названия этапов
- типы работ
- материалы
- кастомные поля (labels)
- чек-листы QA

Технически:
- поля вида `name_i18n JSONB`
- fallback на EN

---

## 3) Мультивалюта

### 3.1 Базовые принципы
- У каждого tenant есть **базовая валюта** (`tenant.base_currency`)
- Все расчёты хранятся в базовой валюте
- Отображение — в валюте пользователя (опционально)

### 3.2 Валюты (старт)
- PLN (Польша)
- EUR (ЕС)
- USD (США)

В будущем:
- GBP, CHF, SEK и др.

---

### 3.3 Курсы валют
Подходы:
- внешний FX API (ежедневное обновление)
- хранение `exchange_rate` с датой

Правило:
- смета и инвойс **фиксируют курс на момент создания**

---

## 4) Цены, сметы и отчёты
- `amount_base` — сумма в базовой валюте tenant
- `amount_display` — сумма в выбранной валюте
- отчёты и аналитика считаются только в base currency

---

## 5) Форматы (локализация)

### Даты
- PL/EU: DD.MM.YYYY
- US: MM/DD/YYYY

### Числа
- EU: 1 234,56
- US: 1,234.56

### Единицы измерения
- м² / пог.м / шт — глобально
- при необходимости: футы/дюймы (US, позже)

---

## 6) Архитектура i18n

### Frontend
- next-intl / i18n routing
- lazy loading переводов

### Backend
- locale-aware сервисы
- i18n middleware

---

## 7) Operator Console (i18n)
- Язык интерфейса оператора
- Tenant locale override (для поддержки)

---

## 8) Anti-patterns (чего не делать)
- Не привязывать валюту к языку
- Не хранить суммы только в display currency
- Не хардкодить строки в коде

---

## 9) Checklist готовности
- [ ] RU/PL работают полностью
- [ ] EN fallback
- [ ] Валюта не ломает аналитику
- [ ] Инвойсы фиксируют курс

